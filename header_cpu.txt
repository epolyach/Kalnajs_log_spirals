#!/usr/bin/env julia
"""
Kalnajs Log-Spiral CPU Solver - Standalone Version

Usage: julia --project=. NL_julia_gpu.jl [options]

Options:
  --config=FILE    Configuration file (default: configs/default.toml)
            GPU selection: 0, 1 (default: all available)
  --threads=N      BLAS threads limit (default: from config)

Examples:
  julia --project=. NL_julia_gpu.jl --config=configs/default.toml --gpu=01
  julia --project=. NL_julia_gpu.jl --config=configs/large.toml --gpu=0 --threads=4
"""

start_time = time()

using LinearAlgebra
using SpecialFunctions
using Printf
using CUDA
using TOML

# ==================== CLI PARSING ====================
function parse_args()
    config_file = "configs/default.toml"
    gpu_spec = "all"
    threads_override = nothing
    
    for arg in ARGS
        if startswith(arg, "--config=")
            config_file = split(arg, "=")[2]
        elseif startswith(arg, "--gpu=")
            gpu_spec = split(arg, "=")[2]
        elseif startswith(arg, "--threads=")
            threads_override = parse(Int, split(arg, "=")[2])
        elseif arg == "--help" || arg == "-h"
            println(@doc)
            exit(0)
        end
    end
    return config_file, gpu_spec, threads_override
end

config_file, gpu_spec, threads_override = parse_args()

# ==================== LOAD CONFIG ====================
println("Loading config: $config_file")
config = TOML.parsefile(config_file)
